{% extends 'base.html.twig' %}

{% block title %}Détails de la demande #{{ demande.id }} - Allo Ambulance{% endblock %}

{% block body %}
<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-10">
            <!-- Bouton retour -->
            <div class="mb-4">
                <a href="{{ path('app_historique') }}" class="btn btn-outline-secondary">
                    <i class="fas fa-arrow-left"></i> Retour à l'historique
                </a>
            </div>

            <!-- carte principale -->
            <div class="card">
                <div class="card-header bg-white">
                    <div class="d-flex justify-content-between align-items-center">
                        <h4 class="mb-0">
                            <i class="fas fa-file-alt"></i> 
                            Détails de la demande #{{ demande.id }}
                        </h4>
                        <span class="badge bg-{{ demande.statut == 'termine' ? 'success' : (demande.statut == 'en_cours' ? 'warning' : 'secondary') }} fs-6">
                            {{ demande.getStatutLabel() }}
                        </span>
                    </div>
                </div>
                
                <div class="card-body">
                    <!-- informations principales -->
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <div class="card border-light">
                                <div class="card-body">
                                    <h5 class="card-title border-bottom pb-2">
                                        <i class="fas fa-info-circle text-primary"></i> Informations générales
                                    </h5>
                                    <div class="row mt-3">
                                        <div class="col-6">
                                            <p class="mb-1"><strong>Type:</strong></p>
                                            <span class="badge bg-{{ demande.type == 'urgence' ? 'danger' : (demande.type == 'muti-urgent' ? 'warning' : 'info') }}">
                                                {{ demande.getTypeLabel() }}
                                            </span>
                                        </div>
                                        <div class="col-6">
                                            <p class="mb-1"><strong>Date de création:</strong></p>
                                            <p>{{ demande.createdAt|date('d/m/Y H:i') }}</p>
                                        </div>
                                    </div>
                                    {% if demande.updatedAt %}
                                    <div class="row mt-2">
                                        <div class="col-12">
                                            <p class="mb-1"><strong>Dernière mise à jour:</strong></p>
                                            <p>{{ demande.updatedAt|date('d/m/Y H:i') }}</p>
                                        </div>
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="card border-light">
                                <div class="card-body">
                                    <h5 class="card-title border-bottom pb-2">
                                        <i class="fas fa-users text-primary"></i> Informations patients
                                    </h5>
                                    <div class="row mt-3">
                                        <div class="col-12">
                                            <p class="mb-1"><strong>Nombre de patients:</strong></p>
                                            <p>{{ demande.nombrePatients ?? 'Non spécifié' }}</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- adresses -->
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <div class="card border-light">
                                <div class="card-body">
                                    <h5 class="card-title border-bottom pb-2">
                                        <i class="fas fa-map-marker-alt text-danger"></i> Adresse de départ
                                    </h5>
                                    <p class="mt-3">{{ demande.adresseDepart }}</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="card border-light">
                                <div class="card-body">
                                    <h5 class="card-title border-bottom pb-2">
                                        <i class="fas fa-flag-checkered text-success"></i> Adresse de destination
                                    </h5>
                                    <p class="mt-3">{{ demande.adresseDestination }}</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ambulance et chauffeur -->
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <div class="card border-light">
                                <div class="card-body">
                                    <h5 class="card-title border-bottom pb-2">
                                        <i class="fas fa-ambulance text-success"></i> Ambulance
                                    </h5>
                                    <div class="mt-3">
                                        {% if demande.ambulance %}
                                            <p><strong>Immatriculation:</strong> {{ demande.ambulance.immatriculation }}</p>
                                            <p><strong>Marque/Modèle:</strong> {{ demande.ambulance.marque }} {{ demande.ambulance.modele }}</p>
                                            <p><strong>Type:</strong> {{ demande.ambulance.type }}</p>
                                            <p><strong>Disponibilité:</strong> 
                                                <span class="badge bg-{{ demande.ambulance.disponible ? 'success' : 'danger' }}">
                                                    {{ demande.ambulance.disponible ? 'Disponible' : 'Occupée' }}
                                                </span>
                                            </p>
                                        {% else %}
                                            <p class="text-muted">Aucune ambulance affectée pour le moment</p>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="card border-light">
                                <div class="card-body">
                                    <h5 class="card-title border-bottom pb-2">
                                        <i class="fas fa-user-tie text-warning"></i> Chauffeur
                                    </h5>
                                    <div class="mt-3">
                                        {% if demande.driver %}
                                            <p><strong>Nom complet:</strong> {{ demande.driver.getFullName() }}</p>
                                            <p><strong>Téléphone:</strong> {{ demande.driver.telephone }}</p>
                                            <p><strong>Permis:</strong> {{ demande.driver.permis }}</p>
                                            <p><strong>Disponibilité:</strong> 
                                                <span class="badge bg-{{ demande.driver.disponible ? 'success' : 'danger' }}">
                                                    {{ demande.driver.disponible ? 'Disponible' : 'Indisponible' }}
                                                </span>
                                            </p>
                                        {% else %}
                                            <p class="text-muted">Aucun chauffeur affecté pour le moment</p>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- notes supplementaires -->
                    {% if demande.notes %}
                    <div class="row mb-4">
                        <div class="col-12">
                            <div class="card border-light">
                                <div class="card-body">
                                    <h5 class="card-title border-bottom pb-2">
                                        <i class="fas fa-sticky-note text-info"></i> Notes supplémentaires
                                    </h5>
                                    <p class="mt-3">{{ demande.notes }}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endif %}

                    <!-- boutons d'action -->
                    <div class="row mt-4">
                        <div class="col-12">
                            <div class="d-flex justify-content-between">
                                {% if demande.statut == 'en_attente' %}
                                <form method="post" action="{{ path('app_demande_delete', {'id': demande.id}) }}" 
                                      onsubmit="return confirm('Êtes-vous sûr de vouloir supprimer cette demande?');">
                                    <input type="hidden" name="_token" value="{{ csrf_token('delete_' ~ demande.id) }}">
                                    <button type="submit" class="btn btn-danger">
                                        <i class="fas fa-trash"></i> Supprimer la demande
                                    </button>
                                </form>
                                {% else %}
                                <div></div>
                                {% endif %}
                                
                                <a href="{{ path('app_historique') }}" class="btn btn-secondary">
                                    <i class="fas fa-arrow-left"></i> Retour
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.card.border-light {
    border: 1px solid #e9ecef !important;
}
.badge {
    font-size: 0.9em;
    padding: 0.4em 0.8em;
}
.card-title {
    font-size: 1.1rem;
    font-weight: 600;
}
</style>
{% endblock %}